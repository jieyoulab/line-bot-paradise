## line-bot-paradise

ä¸€å€‹ **LINE Bot** å¾Œç«¯å°ˆæ¡ˆï¼Œä½¿ç”¨ Node.js/Express å»ºç«‹ï¼Œä¸¦æ•´åˆ **LINE Messaging API** èˆ‡ **Rich Menu éƒ¨ç½²å·¥å…·**ã€‚  
æœ¬å°ˆæ¡ˆæ”¯æ´å¤šç§Ÿæˆ¶ (multi-tenant) æ¶æ§‹ï¼Œå¯ä¾ç…§ä¸åŒå¸³è™Ÿ (å¦‚ `jieyou`, `ruma`) ç®¡ç†å„è‡ªçš„ Rich Menu èˆ‡äº’å‹•æµç¨‹ã€‚

---

### âœ¨ åŠŸèƒ½ç‰¹é»
- ğŸ“© **Webhook è™•ç†**ï¼šæ¥æ”¶èˆ‡è™•ç†ä¾†è‡ª LINE Bot çš„äº‹ä»¶ï¼ˆmessage, follow, postback...ï¼‰ã€‚
- ğŸ—‚ **å¤šç§Ÿæˆ¶æ¶æ§‹**ï¼šä¸åŒå“ç‰Œ/å®¢æˆ¶å¯åˆ†åˆ¥è¨­å®š Rich Menu èˆ‡å›è¦†é‚è¼¯ã€‚
- ğŸ¨ **Rich Menu ç®¡ç†**ï¼šé€é `scripts/richmenu` å·¥å…·å¿«é€Ÿéƒ¨ç½²/æ›´æ–° Rich Menuã€‚
- ğŸ§© **Flex Message æ¨¡çµ„åŒ–**ï¼šä½¿ç”¨ `/flex` ç›®éŒ„ä¸‹çš„æ¨¡æ¿ç”Ÿæˆå‹•æ…‹è¨Šæ¯ï¼ˆå¦‚å•†å“å¡ç‰‡ã€å“ç‰Œæ­¡è¿è¨Šæ¯ï¼‰ã€‚
- ğŸ—„ **è³‡æ–™åº«æ”¯æ´**ï¼šå…§å»º `db` æ¨¡çµ„ï¼Œå¯å„²å­˜ LINE Channelã€ä½¿ç”¨è€…è³‡æ–™ç­‰ã€‚
- ğŸ”§ **å·¥å…·é›†**ï¼šåŒ…å«åœ–ç‰‡å£“ç¸®ã€æ’ç¨‹ã€æ¨¡æ“¬å™¨ç­‰å·¥å…·ã€‚

---

## ğŸš€ å¿«é€Ÿé–‹å§‹

### 1. å®‰è£èˆ‡å•Ÿå‹•

```bash
# å®‰è£ç›¸ä¾å¥—ä»¶
npm install

# å•Ÿå‹•é–‹ç™¼ç’°å¢ƒ
npm run dev

# æ­£å¼ç’°å¢ƒ
npm start
```

ä¼ºæœå™¨å•Ÿå‹•å¾Œæœƒç›£è½ .env å…§è¨­å®šçš„ PORTï¼Œä¸¦æä¾›ï¼š
`POST /webhook-tenant` â†’ æ¥æ”¶ LINE Webhook äº‹ä»¶

### 2. å»ºç«‹ç’°å¢ƒæª”æ¡ˆ

å°ˆæ¡ˆä½¿ç”¨ `.env` æª”æ¡ˆç®¡ç†è¨­å®šï¼Œè«‹å…ˆè¤‡è£½ `.env.example`ï¼š

```bash
cp .env.example .env
```

---

## ğŸ“¦ å¸¸ç”¨æŒ‡ä»¤

å°ˆæ¡ˆåœ¨ `package.json` ä¸­å®šç¾©äº†ä»¥ä¸‹æŒ‡ä»¤ï¼š

| æŒ‡ä»¤                  | èªªæ˜                     |
| --------------------- | ------------------------ |
| `npm run dev`  | ä½¿ç”¨ nodemon å•Ÿå‹•é–‹ç™¼ç’°å¢ƒï¼Œæœƒè‡ªå‹•ç›£æ§æª”æ¡ˆè®Šå‹•é‡å•Ÿä¼ºæœå™¨ |
| `npm start` | å•Ÿå‹•æ­£å¼ç’°å¢ƒ (Node.js ç›´æ¥åŸ·è¡Œ)         |
| `npm test` | æ¸¬è©¦æŒ‡ä»¤           |

---

## ğŸ§¹ å°ˆæ¡ˆçµæ§‹ç°¡ä»‹

```

line-bot-paradise/
â”œâ”€â”€ .env                     # ç’°å¢ƒè®Šæ•¸è¨­å®š (æœ¬æ©Ÿ)
â”œâ”€â”€ .env.example             # ç’°å¢ƒè®Šæ•¸ç¯„ä¾‹
â”œâ”€â”€ .git                     # Git ç‰ˆæœ¬æ§åˆ¶è³‡æ–™å¤¾
â”œâ”€â”€ .gitignore               # Git å¿½ç•¥è¦å‰‡
â”œâ”€â”€ README.md                # å°ˆæ¡ˆèªªæ˜æ–‡ä»¶
â”œâ”€â”€ app.js                   # Express ä¸»æ‡‰ç”¨å…¥å£
â”œâ”€â”€ bin/
â”‚   â””â”€â”€ www.js               # å•Ÿå‹•ä¼ºæœå™¨
â”œâ”€â”€ config/
â”‚   â””â”€â”€ index.js             # ç’°å¢ƒè¨­å®š
â”œâ”€â”€ data/                    
â”‚   â”œâ”€â”€ jieyou/              # ç§Ÿæˆ¶ jieyou è³‡æ–™
â”‚   â””â”€â”€ tenants.json         # å…¨åŸŸç§Ÿæˆ¶æ¸…å–®
â”œâ”€â”€ db/                      # TypeORM è³‡æ–™åº«è¨­å®š
â”‚   â”œâ”€â”€ data-source.js       # DB é€£ç·šè¨­å®š
â”‚   â”œâ”€â”€ entities/            # è³‡æ–™è¡¨å¯¦é«”
â”‚   â””â”€â”€ index.js             # åŒ¯å‡º DB åˆå§‹åŒ–
â”œâ”€â”€ demo/                    # ç¯„ä¾‹è…³æœ¬ / æ¸¬è©¦ç”¨ç¨‹å¼
â”œâ”€â”€ dist/                    # ç·¨è­¯è¼¸å‡º (build å¾Œ)
â”œâ”€â”€ flex/                    # Flex Message æ¨¡æ¿
â”œâ”€â”€ handlers/                # LINE Bot è¨Šæ¯äº‹ä»¶è™•ç†é‚è¼¯
â”‚   â””â”€â”€ eventDispatcher.js   # äº‹ä»¶åˆ†æ´¾å™¨
â”œâ”€â”€ infra/                   # åŸºç¤è¨­æ–½å±¤
â”‚   â”œâ”€â”€ envTenants.js        # ç§Ÿæˆ¶ç’°å¢ƒè®Šæ•¸ç®¡ç†
â”‚   â”œâ”€â”€ lineClient.js        # LINE Bot SDK åˆå§‹åŒ–
â”‚   â”œâ”€â”€ richmenu/            # Rich Menu é è¨­è¨­å®š
â”‚   â””â”€â”€ richmenuLinker.js    # ç¶å®š Rich Menu
â”œâ”€â”€ public/                  # éœæ…‹è³‡æº
â”œâ”€â”€ routes/
â”‚   â””â”€â”€ webhook-tenant.js    # Webhook è·¯ç”± (å¤šç§Ÿæˆ¶)
â”œâ”€â”€ scripts/                 # è…³æœ¬å·¥å…·
â”‚   â”œâ”€â”€ richmenu/            # Rich Menu éƒ¨ç½²èˆ‡æ“ä½œ
â”‚   â”œâ”€â”€ setup-richmenu-3tabs.js # ä¸‰åˆ†é  Rich Menu è¨­å®š
â”‚   â””â”€â”€ tools/               # å·¥å…·è…³æœ¬ (å£“ç¸®åœ–ç‰‡ç­‰)
â”œâ”€â”€ test.js                  # æ¸¬è©¦å…¥å£
â”œâ”€â”€ utils/
â”‚   â””â”€â”€ logger.js            # å…±ç”¨ logger
â”œâ”€â”€ package.json             # å°ˆæ¡ˆè¨­å®šèˆ‡ä¾è³´
â”œâ”€â”€ package-lock.json        # ä¾è³´ç‰ˆæœ¬é–å®š
â””â”€â”€ node_modules/            # å®‰è£å¥—ä»¶

```

---

## ğŸ¨ Rich Menu æœ¬åœ°ç«¯éƒ¨ç½²

å»ºç«‹ç§Ÿæˆ¶ Rich Menuï¼Œä¾‹å¦‚ç§Ÿæˆ¶åç¨±ç‚º `jieyou`ï¼š

```bash
node scripts/richmenu/deployTenant.js jieyou
```

- åŸ·è¡Œå¾Œæœƒå°‡å°æ‡‰ç§Ÿæˆ¶çš„ Rich Menu è¨»å†Šåˆ° LINE å®˜æ–¹å¸³è™Ÿï¼Œä»¥ä¾¿æ¸¬è©¦

---
